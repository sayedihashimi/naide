# Changelog

All notable changes to the Naide VS Code extension will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
- Conversation context support: Extension now maintains full conversation history within a chat session
- Previous messages from the same chat are included when sending requests to the language model
- LICENSE file added to extension directory (resolves packaging warning)
- **Tool invocation support**: Language model can now create and edit files in the workspace
- Multi-round tool execution: Handles tool calls from the language model and returns results
- **Manual file creation**: Workaround for copilot_createFile bug using vscode.workspace.fs API
- Files are created directly using VS Code's file system API (bypasses broken copilot_createFile tool)
- Ensures parent directories exist before creating files (recursive directory creation)

### Fixed
- **File creation "Invalid stream" error**: Implemented manual file creation using vscode.workspace.fs.writeFile()
- copilot_createFile tool has persistent bug in VS Code Insiders - now bypassed with direct API calls
- Files and directories now created successfully in workspace
- **Path Resolution - Critical Fix**: Extension now validates and corrects absolute paths generated by the model that are outside the workspace
- Model-generated paths like `c:/Users/drewb/...` are now detected and corrected to use actual workspace root
- **Workspace Context in Instructions**: System prompts now include workspace root path to encourage model to use relative paths
- Improved logging to only show "Path resolved" when paths actually change (not just object identity)
- Prevents confusing permission dialogs for directories outside workspace
- Handles both relative paths (convert to absolute) and wrong absolute paths (extract pattern and re-resolve)
- **Model Selection**: Improved Claude Opus detection - now checks both family and name fields
- **Tool Result Handling**: Robust processing of tool results with timeout and error recovery
- **Path Resolution**: Relative paths automatically converted to absolute paths based on workspace root (fixes file creation errors)
- **Logging**: Enhanced model selection logging shows all available models with full details
- Tool invocation now handles tools that succeed without returning content
- **Dedicated "Naide" output channel**: All diagnostic logs now visible in Output panel under "Naide"
- Logger utility module for consistent logging across extension
- **Directory creation instructions**: System prompts now instruct model to create directories before files

### Changed
- System prompts are now bundled with the extension instead of being loaded from workspace
- Removed `naide.systemPromptsPath` configuration setting (system prompts are always bundled)
- Default mode is now Planning (when no slash command is specified)
- Package size increased to 40.87 KB (from initial 15.91 KB)
- Switched from streaming `.text` to `.stream` to handle both text and tool call parts
- All `console.log()` statements replaced with OutputChannel logging for user visibility
- **Pass all available tools to language model** (not just naide_searchLearnings)
- **Model selection now prefers Claude Opus 4.5**: Falls back to Claude, then GPT-4o, then any Copilot model
- **Simplified tool invocation**: Removed manual tool invocation code - let VS Code handle it automatically

### Fixed
- **File creation now works**: Language model receives all VS Code tools (copilot_createFile, copilot_editFiles, etc.)
- Previously only passed empty array when naide_searchLearnings wasn't registered
- **Tool invocation "Invalid stream" error fixed**: Pass `undefined` for toolInvocationToken (chat participants don't have tokens)
- **Model selection fixed**: No longer hardcoded to GPT-4o, now prefers Claude Opus 4.5 as intended
- **Directory creation**: System prompts now explicitly instruct to create directories before files

### Removed
- Auto mode support and `auto.system.md` system prompt
- Analyzing mode support and `analyzing.system.md` system prompt
- `/analyze` slash command
- Manual tool invocation code (VS Code handles this automatically)

## [0.1.0] - 2026-02-17

### Added
- Initial release of Naide VS Code extension
- Chat participant registration (`@naide`)
- Slash commands: `/plan`, `/build`
- System prompt loading (bundled with extension)
- Specification file loading from `.prompts/plan/`
- Feature file loading from `.prompts/features/`
- `search_learnings` language model tool
- Configuration settings for custom paths
- Full TypeScript implementation with strict mode
- Comprehensive README with usage instructions

### Features
- Reuses existing Naide project structure and system prompts
- Integrates seamlessly with VS Code's native UI
- Works with GitHub Copilot Chat
- Provides project-aware AI assistance
- Supports professional developer workflows

[0.1.0]: https://github.com/sayedihashimi/naide/releases/tag/v0.1.0
