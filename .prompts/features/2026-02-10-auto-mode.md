---
Status: planned
Area: ui, copilot, chat
Created: 2026-02-10
LastUpdated: 2026-02-10
---

# Feature: Auto Mode â€” Intelligent Intent-Based Mode Selection
**Status**: ðŸŸ¡ PLANNED

## Summary
Add an **Auto** option to the mode selector dropdown that becomes the default selection. In Auto mode, Copilot infers whether the user's request is a planning task or a building task, proposes an action plan, and asks the user to confirm before proceeding. This simplifies the experience for non-professional developers who shouldn't need to know whether they're "planning" or "building" â€” they just describe what they want.

The existing Planning, Building, and Analyzing modes remain as explicit fallback options.

---

## Goals
- Simplify the default user experience by removing the need to choose a mode
- Let Copilot classify user intent and load the appropriate system prompts automatically
- Use a propose-and-confirm pattern so users always understand what Copilot will do before it does it
- Keep explicit modes accessible for users who prefer manual control
- Default to planning behavior when intent is ambiguous

---

## Non-Goals
- Removing the mode dropdown entirely (it remains as an escape hatch)
- Changing the behavior of existing Planning, Building, or Analyzing modes
- Auto-detecting when to switch from planning to building mid-response without user confirmation
- Adding new Copilot SDK features or tools beyond the existing infrastructure

---

## Problem Statement
Currently, users must manually select Planning or Building mode before chatting. This requires them to understand the distinction between spec-focused planning and code-focused building â€” a conceptual overhead that non-professional developers shouldn't need. Users often just want to say "add a login page" and have Copilot figure out whether that requires planning first or can go straight to implementation.

Auto mode bridges this gap by making Copilot the decision-maker, with the user retaining approval authority.

---

## Core Behavior

### Mode Dropdown Changes

**New dropdown options (in order):**
1. **Auto** â€” default selection, no description text
2. **Planning** â€” `(Create/update specs only)`
3. **Building** â€” `(Update code and specs)`
4. **Analyzing** â€” `(Coming soon)`

**Auto is selected by default** when the app starts, when a new chat is created, and when a project is loaded.

### Intent Classification

When in Auto mode, Copilot classifies each user message into one of these categories:

| Category | Behavior | Examples |
|----------|----------|---------|
| **Planning** | Load planning system prompts, create/update specs | "I want to add dark mode", "Let's plan the auth system", "What features should we add?" |
| **Building** | Load building system prompts, implement code changes | "Fix the bug in App.tsx", "Add a button to the header", "Run the tests" |
| **Ambiguous** | Default to **planning** behavior, ask clarifying questions | "Login page", "Authentication", "Make it faster" |

**Key rule: When unsure, default to planning.** Planning is the safer choice â€” it gathers requirements and creates specs without touching code. Building can always follow after planning.

### Propose-and-Confirm Flow

When Auto mode classifies a request, Copilot responds with:

1. A brief statement of what it understood
2. A summary of proposed actions (what it plans to do)
3. A question asking the user to confirm or redirect

**Example â€” Planning detected:**
```
I understand you want to add a user authentication system to your app.

Here's what I'd like to do:
- Create a feature specification for the authentication system
- Define the user flow (login, logout, registration)
- Update the app spec to include this feature
- Identify any dependencies or constraints

Shall I create this plan, or would you prefer to start building directly?
```

**Example â€” Building detected:**
```
I see the login button needs to be moved to the right side of the header.

Here's what I'd like to do:
- Update src/components/Header.tsx to reposition the button
- Verify the build still passes
- Update the relevant feature spec if needed

Shall I go ahead and make these changes?
```

**Example â€” Ambiguous, defaults to planning:**
```
You mentioned "authentication" â€” I'd like to understand more before we proceed.

A few questions:
1. What type of authentication? (username/password, OAuth, API keys)
2. Who needs to authenticate? (end users, admins, API clients)
3. Do you have any existing auth infrastructure?

Once I understand the requirements, I can create a detailed plan or jump straight to implementation â€” whichever you prefer.
```

### System Prompt Loading

**When mode is Auto:**
1. Load `base.system.md` (always)
2. Load `auto.system.md` (new â€” contains intent classification instructions and propose-and-confirm rules)
3. Load **both** `planning.system.md` and `building.system.md` so Copilot has both rulesets available
4. Copilot uses the auto system prompt to decide which ruleset to follow for each request

**When Copilot decides to plan:** It follows the rules from `planning.system.md` (update specs, ask questions, no code changes)

**When Copilot decides to build:** It follows the rules from `building.system.md` (write code, update specs, verify builds)

**Default behavior:** If classification is uncertain, follow planning rules.

### Visual Indicator

When Auto mode selects a behavior, show a subtle indicator near the mode dropdown so users know which behavior is active:

**Display:** A small text label appears next to the dropdown showing the inferred mode:
- `Auto Â· Planning` (when planning behavior is active)
- `Auto Â· Building` (when building behavior is active)
- `Auto` (before first message or during classification)

**Styling:**
- Text: `text-xs text-zinc-500`
- The label updates based on Copilot's response (parsed from a response marker or inferred from actions taken)
- This is informational only â€” clicking it does nothing

### Mid-Conversation Behavior

**The dropdown always stays on "Auto"** during an Auto mode session, even when Copilot switches between planning and building behaviors. The visual indicator shows the current behavior.

**Seamless switching:** Copilot can switch between planning and building within the same conversation without the user changing the dropdown. For example:
1. User: "Add a contact form" â†’ Copilot plans (creates spec)
2. User: "Looks good, build it" â†’ Copilot builds (writes code)
3. User: "Actually, also add email validation" â†’ Copilot plans the addition, then offers to build

The dropdown remains on "Auto" throughout. Only the visual indicator changes.

---

## New System Prompt: `auto.system.md`

Create `.prompts/system/auto.system.md` with the following responsibilities:

### Intent Classification Instructions
- Analyze each user message to determine if it's a planning or building request
- Consider conversation context (if previous messages were planning, continuation is likely planning)
- Default to planning when ambiguous

### Classification Signals

**Planning signals:**
- Questions about features, requirements, or architecture
- Requests to "plan", "design", "spec", "think about"
- Vague or high-level feature descriptions
- First mention of a new feature area
- Requests involving multiple components or systems
- No existing spec for the requested feature

**Building signals:**
- Explicit requests to "build", "implement", "fix", "add", "change", "update"
- References to specific files or code locations
- Bug fixes with clear reproduction steps
- Simple, well-defined changes (move a button, change a color)
- Existing spec already covers the requested feature
- Follow-up to a completed plan ("looks good, do it")

**Ambiguous (default to planning):**
- Single-word or very short requests
- Feature names without context
- Requests that could go either way

### Propose-and-Confirm Rules
- Always summarize what you understood
- Always list the proposed actions before taking them
- Always ask the user to confirm or redirect
- If the user says "just do it" or "go ahead", proceed with the inferred mode
- If the user corrects the direction ("no, I want to plan first"), switch accordingly

### Mode Behavior Adherence
- When acting as planner: follow ALL rules from `planning.system.md`
- When acting as builder: follow ALL rules from `building.system.md`
- Do not blend behaviors â€” pick one per response and follow its full ruleset

### Response Marker
Include a machine-readable marker in responses to indicate the selected behavior:

```
<!-- AUTO_MODE: planning -->
```
or
```
<!-- AUTO_MODE: building -->
```

This marker is used by the frontend to update the visual indicator. It should appear near the top of the response and is hidden from the rendered markdown.

---

## Technical Implementation

### Frontend Changes

**File**: `src/naide-desktop/src/pages/GenerateAppScreen.tsx`

#### Type Update
```typescript
type CopilotMode = 'Auto' | 'Planning' | 'Building' | 'Analyzing';
```

#### Default Mode
Change default mode from `'Planning'` to `'Auto'`:
```typescript
const [copilotMode, setCopilotMode] = useState<CopilotMode>('Auto');
```

#### Mode Descriptions
```typescript
const MODE_DESCRIPTIONS: Record<CopilotMode, string> = {
  Auto: '',
  Planning: '(Create/update specs only)',
  Building: '(Update code and specs)',
  Analyzing: '(Coming soon)',
};
```

#### Visual Indicator State
```typescript
const [autoModeInferredBehavior, setAutoModeInferredBehavior] = useState<'planning' | 'building' | null>(null);
```

#### Parse Response Marker
When streaming a response in Auto mode, detect the `<!-- AUTO_MODE: xxx -->` marker in the streamed content:

```typescript
// During streaming, check for AUTO_MODE marker
const autoModeMatch = chunk.match(/<!-- AUTO_MODE: (planning|building) -->/);
if (autoModeMatch) {
  setAutoModeInferredBehavior(autoModeMatch[1] as 'planning' | 'building');
}
```

The marker is hidden from rendered markdown (HTML comments are not displayed).

#### Dropdown Rendering
```tsx
<select value={copilotMode} onChange={...}>
  <option value="Auto">Auto</option>
  <option value="Planning">Planning</option>
  <option value="Building">Building</option>
  <option value="Analyzing">Analyzing</option>
</select>
{copilotMode === 'Auto' && autoModeInferredBehavior && (
  <span className="text-xs text-zinc-500 ml-1">
    Â· {autoModeInferredBehavior === 'planning' ? 'Planning' : 'Building'}
  </span>
)}
{copilotMode !== 'Auto' && MODE_DESCRIPTIONS[copilotMode] && (
  <span className="text-xs text-gray-500">{MODE_DESCRIPTIONS[copilotMode]}</span>
)}
```

#### Reset Inferred Behavior
- Reset `autoModeInferredBehavior` to `null` when:
  - User sends a new message (before response arrives)
  - User switches mode in dropdown
  - New chat is created

### Sidecar Changes

**File**: `src/copilot-sidecar/src/index.ts`

#### System Prompt Loading for Auto Mode
In the `loadSystemPrompts` function (or equivalent), add handling for Auto mode:

```typescript
if (mode === 'Auto') {
  // Load base + auto + both planning and building prompts
  const basePrompt = await loadFile('.prompts/system/base.system.md');
  const autoPrompt = await loadFile('.prompts/system/auto.system.md');
  const planningPrompt = await loadFile('.prompts/system/planning.system.md');
  const buildingPrompt = await loadFile('.prompts/system/building.system.md');
  
  return [basePrompt, autoPrompt, planningPrompt, buildingPrompt]
    .filter(Boolean)
    .join('\n\n');
}
```

**Prompt assembly order for Auto mode:**
1. `base.system.md`
2. `auto.system.md` (intent classification + propose-and-confirm rules)
3. `planning.system.md` (available for planning behavior)
4. `building.system.md` (available for building behavior)
5. Spec files from `.prompts/plan/`
6. Feature files from `.prompts/features/`
7. Conversation summary
8. Recent messages
9. Current user message

#### Streaming Endpoint
The streaming endpoint at `/api/copilot/stream` already accepts a `mode` string. No changes needed â€” it will receive `'Auto'` and the `loadSystemPrompts` function handles the rest.

### New System Prompt File

**File**: `.prompts/system/auto.system.md`

Create this file with the intent classification instructions, propose-and-confirm rules, and response marker format described above. See the "New System Prompt" section for full content requirements.

---

## Welcome Messages

When Auto mode is active and chat is initialized, show welcome messages that reflect the simplified experience:

```
Welcome to Naide! ðŸ‘‹

Just tell me what you'd like to do â€” I'll figure out whether we need to plan first or jump straight to building.

You can describe a new feature, ask me to fix something, or just brainstorm ideas. I'll always check with you before taking action.
```

---

## Chat Persistence

The `copilotMode` value `'Auto'` is saved in chat session files just like other modes. When loading an archived chat that was in Auto mode, the dropdown restores to Auto.

The `autoModeInferredBehavior` is NOT persisted â€” it's ephemeral UI state that resets on load.

---

## Edge Cases

### User Switches From Auto to Explicit Mode
- Dropdown changes to the selected mode
- `autoModeInferredBehavior` resets to null
- Visual indicator disappears
- Copilot uses only the selected mode's system prompt

### User Switches From Explicit Mode to Auto
- Dropdown changes to Auto
- `autoModeInferredBehavior` starts as null
- On next message, Copilot classifies intent and sets the indicator

### Analyzing Mode in Auto
- Auto mode does NOT infer Analyzing behavior
- If the user wants analysis, they should select Analyzing explicitly
- Auto only switches between Planning and Building

### Long Conversations With Mixed Intent
- Each message is classified independently, informed by conversation context
- Copilot can switch between planning and building seamlessly
- The visual indicator updates with each response

### Empty or Very Short Messages
- Messages like "yes", "ok", "do it" are interpreted in conversation context
- If previous response was a plan proposal, "do it" means "build it"
- If no context, default to asking a clarifying question (planning behavior)

### Marker Not Found in Response
- If the response doesn't contain `<!-- AUTO_MODE: xxx -->`, the indicator shows nothing (stays as `Auto` without a behavior label)
- This is fine â€” not every response needs explicit classification (e.g., follow-up questions)

---

## Acceptance Criteria

- [ ] "Auto" appears as the first option in the mode dropdown
- [ ] Auto is selected by default on app launch, new chat, and project load
- [ ] No description text is shown next to the dropdown when Auto is selected (before first response)
- [ ] Explicit modes (Planning, Building, Analyzing) remain unchanged in behavior
- [ ] `auto.system.md` system prompt file is created with intent classification and propose-and-confirm rules
- [ ] In Auto mode, both `planning.system.md` and `building.system.md` are loaded alongside `auto.system.md`
- [ ] Copilot proposes actions and asks for confirmation before proceeding
- [ ] When intent is ambiguous, Copilot defaults to planning behavior
- [ ] Visual indicator shows "Auto Â· Planning" or "Auto Â· Building" based on response marker
- [ ] Visual indicator resets on new message send and mode switch
- [ ] Dropdown stays on "Auto" during mid-conversation behavior switches
- [ ] Mode value `'Auto'` is persisted in chat session files
- [ ] Auto mode inferred behavior is NOT persisted (ephemeral UI state)
- [ ] Welcome messages are updated for Auto mode
- [ ] Sidecar handles `'Auto'` mode correctly in streaming and non-streaming endpoints
- [ ] App builds and all existing tests pass

---

## Files to Create

- `.prompts/system/auto.system.md` â€” Intent classification, propose-and-confirm rules, response marker format

## Files to Modify

### Frontend
- `src/naide-desktop/src/pages/GenerateAppScreen.tsx` â€” Add Auto mode to type, default selection, visual indicator, response marker parsing, welcome messages
- `src/naide-desktop/src/pages/GenerateAppScreen.test.tsx` â€” Update tests for new default mode and Auto behavior

### Sidecar
- `src/copilot-sidecar/src/index.ts` â€” Handle Auto mode in `loadSystemPrompts`, load all three prompt files

### Planning Specs
- `.prompts/plan/app-spec.md` â€” Add Auto mode to mode selector description
- `.prompts/plan/data-spec.md` â€” Update CopilotRequest mode type to include 'Auto'

---

## Future Enhancements

### Learning From User Corrections
- If the user frequently corrects Auto's classification (e.g., "no, I want to plan first"), write a learning about the user's preferences
- Over time, Auto mode becomes better at classifying for this specific user/project

### Confidence Indicator
- Show how confident Auto is in its classification (high/medium/low)
- Low confidence triggers more explicit confirmation

### Context-Aware Defaults
- If the project has no specs yet, bias toward planning
- If specs are comprehensive and the request references specific files, bias toward building
- Use the presence/absence of feature specs as a signal

### Auto + Analyzing
- Eventually include analyzing behavior in Auto mode
- "How does the auth system work?" â†’ Analyzing
- "Why is the build failing?" â†’ Analyzing

---

## Related Features
- [2026-02-01-generate-app-screen.md](./2026-02-01-generate-app-screen.md) â€” Mode selector UI
- [2026-02-01-add-copilot-integration.md](./2026-02-01-add-copilot-integration.md) â€” Copilot SDK integration
- [2026-02-01-building-mode.md](./2026-02-01-building-mode.md) â€” Building mode behavior
- [2026-02-01-conversation-memory.md](./2026-02-01-conversation-memory.md) â€” Conversation context for intent classification

---

created by naide
